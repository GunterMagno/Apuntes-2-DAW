<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MongoDB - Wiki 2º DAW</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-book-open"></i>
                <h1>Wiki 2º DAW</h1>
            </div>
            <a href="../index.html" class="back-button">
                <i class="fas fa-arrow-left"></i> Volver al inicio
            </a>
        </div>
    </nav>

    <div class="detail-page">
        <div class="detail-header">
            <div class="detail-icon" style="color: var(--mongodb-color);">
                <i class="fas fa-database"></i>
            </div>
            <h1 class="detail-title">MongoDB</h1>
            <p class="detail-subtitle">Base de datos NoSQL orientada a documentos</p>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-info-circle"></i> ¿Qué es MongoDB?</h2>
            <p>
                MongoDB es una base de datos NoSQL orientada a documentos que almacena datos en formato JSON flexible 
                (BSON internamente). A diferencia de las bases de datos relacionales tradicionales, MongoDB no utiliza 
                tablas y filas, sino colecciones y documentos.
            </p>
            
            <div class="info-box">
                <h4><i class="fas fa-lightbulb"></i> Características principales</h4>
                <ul>
                    <li><strong>Orientada a documentos:</strong> Datos en formato JSON/BSON</li>
                    <li><strong>Schema flexible:</strong> No requiere estructura rígida</li>
                    <li><strong>Escalabilidad horizontal:</strong> Sharding nativo</li>
                    <li><strong>Alto rendimiento:</strong> Índices y consultas eficientes</li>
                    <li><strong>Replicación:</strong> Alta disponibilidad con Replica Sets</li>
                    <li><strong>Agregaciones potentes:</strong> Pipeline de agregación complejo</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-sitemap"></i> Conceptos clave de MongoDB</h2>
            
            <h3>Estructura de datos</h3>
            <ul>
                <li><strong>Base de datos:</strong> Contenedor de colecciones</li>
                <li><strong>Colección:</strong> Grupo de documentos (equivalente a tabla)</li>
                <li><strong>Documento:</strong> Registro individual en formato BSON (equivalente a fila)</li>
                <li><strong>Campo:</strong> Par clave-valor dentro de un documento (equivalente a columna)</li>
                <li><strong>_id:</strong> Identificador único automático de cada documento</li>
            </ul>

            <h3>Ejemplo de documento MongoDB</h3>
            <div class="code-block">
                <pre>
{
  "_id": ObjectId("507f1f77bcf86cd799439011"),
  "nombre": "Juan Pérez",
  "email": "juan@email.com",
  "edad": 28,
  "direccion": {
    "calle": "Av. Principal 123",
    "ciudad": "Madrid",
    "codigoPostal": "28001"
  },
  "intereses": ["programación", "música", "deportes"],
  "activo": true,
  "fechaRegistro": ISODate("2025-01-15T10:30:00Z")
}
                </pre>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-code"></i> Operaciones CRUD en MongoDB</h2>
            
            <h3>1. CREATE - Insertar documentos</h3>
            <div class="code-block">
                <pre>
// Insertar un documento
db.usuarios.insertOne({
  nombre: "Ana García",
  email: "ana@email.com",
  edad: 25,
  ciudad: "Barcelona"
});

// Insertar múltiples documentos
db.usuarios.insertMany([
  {
    nombre: "Pedro López",
    email: "pedro@email.com",
    edad: 30
  },
  {
    nombre: "María Sánchez",
    email: "maria@email.com",
    edad: 27
  }
]);
                </pre>
            </div>

            <h3>2. READ - Consultar documentos</h3>
            <div class="code-block">
                <pre>
// Encontrar todos los documentos
db.usuarios.find();

// Encontrar con filtro
db.usuarios.find({ edad: 25 });

// Encontrar con múltiples condiciones
db.usuarios.find({
  edad: { $gte: 25 },  // Mayor o igual a 25
  ciudad: "Madrid"
});

// Encontrar uno
db.usuarios.findOne({ email: "ana@email.com" });

// Proyección (seleccionar campos específicos)
db.usuarios.find({}, { nombre: 1, email: 1, _id: 0 });

// Ordenar resultados
db.usuarios.find().sort({ edad: -1 });  // -1 descendente, 1 ascendente

// Limitar resultados
db.usuarios.find().limit(5);

// Saltar resultados (paginación)
db.usuarios.find().skip(10).limit(5);

// Contar documentos
db.usuarios.countDocuments({ edad: { $gte: 25 } });

// Operadores de comparación
db.usuarios.find({ edad: { $gt: 25 } });      // Mayor que
db.usuarios.find({ edad: { $gte: 25 } });     // Mayor o igual
db.usuarios.find({ edad: { $lt: 30 } });      // Menor que
db.usuarios.find({ edad: { $lte: 30 } });     // Menor o igual
db.usuarios.find({ edad: { $ne: 25 } });      // No igual
db.usuarios.find({ edad: { $in: [25, 30] } }); // En array
                </pre>
            </div>

            <h3>3. UPDATE - Actualizar documentos</h3>
            <div class="code-block">
                <pre>
// Actualizar un documento
db.usuarios.updateOne(
  { email: "ana@email.com" },     // Filtro
  { $set: { edad: 26 } }          // Actualización
);

// Actualizar múltiples documentos
db.usuarios.updateMany(
  { ciudad: "Madrid" },
  { $set: { pais: "España" } }
);

// Incrementar valor
db.usuarios.updateOne(
  { email: "ana@email.com" },
  { $inc: { edad: 1 } }  // Incrementa edad en 1
);

// Agregar elemento a array
db.usuarios.updateOne(
  { email: "ana@email.com" },
  { $push: { intereses: "lectura" } }
);

// Eliminar campo
db.usuarios.updateOne(
  { email: "ana@email.com" },
  { $unset: { campo_temporal: "" } }
);

// Reemplazar documento completo
db.usuarios.replaceOne(
  { email: "ana@email.com" },
  {
    nombre: "Ana García Updated",
    email: "ana@email.com",
    edad: 26
  }
);
                </pre>
            </div>

            <h3>4. DELETE - Eliminar documentos</h3>
            <div class="code-block">
                <pre>
// Eliminar un documento
db.usuarios.deleteOne({ email: "ana@email.com" });

// Eliminar múltiples documentos
db.usuarios.deleteMany({ edad: { $lt: 18 } });

// Eliminar todos los documentos de una colección
db.usuarios.deleteMany({});
                </pre>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-search"></i> Consultas avanzadas</h2>
            
            <h3>Operadores lógicos</h3>
            <div class="code-block">
                <pre>
// AND implícito
db.usuarios.find({
  edad: { $gte: 25 },
  ciudad: "Madrid"
});

// OR
db.usuarios.find({
  $or: [
    { edad: { $lt: 20 } },
    { edad: { $gt: 60 } }
  ]
});

// NOT
db.usuarios.find({
  edad: { $not: { $gte: 25 } }
});

// NOR
db.usuarios.find({
  $nor: [
    { edad: { $lt: 20 } },
    { ciudad: "Madrid" }
  ]
});
                </pre>
            </div>

            <h3>Consultas en arrays</h3>
            <div class="code-block">
                <pre>
// Buscar por elemento en array
db.usuarios.find({
  intereses: "programación"
});

// Buscar múltiples elementos
db.usuarios.find({
  intereses: { $all: ["programación", "música"] }
});

// Tamaño del array
db.usuarios.find({
  intereses: { $size: 3 }
});

// Elemento del array que cumpla condición
db.usuarios.find({
  "puntuaciones.nota": { $gte: 9 }
});
                </pre>
            </div>

            <h3>Pipeline de agregación</h3>
            <div class="code-block">
                <pre>
// Ejemplo completo de agregación
db.usuarios.aggregate([
  // Filtrar documentos
  {
    $match: {
      edad: { $gte: 25 }
    }
  },
  // Agrupar y calcular
  {
    $group: {
      _id: "$ciudad",
      total: { $sum: 1 },
      edadPromedio: { $avg: "$edad" },
      edadMaxima: { $max: "$edad" }
    }
  },
  // Ordenar resultados
  {
    $sort: { total: -1 }
  },
  // Limitar resultados
  {
    $limit: 5
  },
  // Proyectar campos
  {
    $project: {
      ciudad: "$_id",
      total: 1,
      edadPromedio: { $round: ["$edadPromedio", 2] },
      _id: 0
    }
  }
]);
                </pre>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-code"></i> Mongoose con Node.js</h2>
            
            <h3>1. Instalación y conexión</h3>
            <div class="code-block">
                <pre>
// Instalar mongoose
npm install mongoose

// Conectar a MongoDB
const mongoose = require('mongoose');

mongoose.connect('mongodb://localhost:27017/miBaseDatos', {
  useNewUrlParser: true,
  useUnifiedTopology: true
})
.then(() => console.log('Conectado a MongoDB'))
.catch(err => console.error('Error de conexión:', err));
                </pre>
            </div>

            <h3>2. Definir Schema y Model</h3>
            <div class="code-block">
                <pre>
// models/Usuario.js
const mongoose = require('mongoose');

const usuarioSchema = new mongoose.Schema({
  nombre: {
    type: String,
    required: [true, 'El nombre es obligatorio'],
    trim: true,
    minlength: 3,
    maxlength: 100
  },
  email: {
    type: String,
    required: true,
    unique: true,
    lowercase: true,
    match: [/^\S+@\S+\.\S+$/, 'Email inválido']
  },
  edad: {
    type: Number,
    min: 0,
    max: 120
  },
  direccion: {
    calle: String,
    ciudad: String,
    codigoPostal: String
  },
  intereses: [String],
  activo: {
    type: Boolean,
    default: true
  },
  fechaRegistro: {
    type: Date,
    default: Date.now
  }
}, {
  timestamps: true  // Agrega createdAt y updatedAt automáticamente
});

// Métodos del schema
usuarioSchema.methods.obtenerNombreCompleto = function() {
  return this.nombre.toUpperCase();
};

// Statics del schema
usuarioSchema.statics.buscarPorEmail = function(email) {
  return this.findOne({ email });
};

module.exports = mongoose.model('Usuario', usuarioSchema);
                </pre>
            </div>

            <h3>3. Operaciones CRUD con Mongoose</h3>
            <div class="code-block">
                <pre>
const Usuario = require('./models/Usuario');

// CREATE
const nuevoUsuario = new Usuario({
  nombre: 'Juan Pérez',
  email: 'juan@email.com',
  edad: 28
});

nuevoUsuario.save()
  .then(usuario => console.log('Usuario creado:', usuario))
  .catch(err => console.error('Error:', err));

// O con async/await
async function crearUsuario() {
  try {
    const usuario = await Usuario.create({
      nombre: 'Ana García',
      email: 'ana@email.com',
      edad: 25
    });
    console.log('Usuario creado:', usuario);
  } catch (err) {
    console.error('Error:', err);
  }
}

// READ
// Encontrar todos
const usuarios = await Usuario.find();

// Encontrar con filtro
const usuariosMayores = await Usuario.find({ edad: { $gte: 25 } });

// Encontrar uno
const usuario = await Usuario.findById(id);
const usuario2 = await Usuario.findOne({ email: 'ana@email.com' });

// Con populate (relaciones)
const usuario3 = await Usuario.findById(id).populate('pedidos');

// UPDATE
// Actualizar y devolver documento actualizado
const actualizado = await Usuario.findByIdAndUpdate(
  id,
  { edad: 26 },
  { new: true, runValidators: true }
);

// Actualizar con findOne y save
const usuario4 = await Usuario.findById(id);
usuario4.edad = 27;
await usuario4.save();

// DELETE
await Usuario.findByIdAndDelete(id);
await Usuario.deleteMany({ activo: false });
                </pre>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-terminal"></i> Comandos MongoDB</h2>
            
            <div class="command-item">
                <code>mongod</code>
                <span>Inicia el servidor de MongoDB</span>
            </div>

            <div class="command-item">
                <code>mongosh</code>
                <span>Abre el shell interactivo de MongoDB</span>
            </div>

            <div class="command-item">
                <code>show dbs</code>
                <span>Lista todas las bases de datos</span>
            </div>

            <div class="command-item">
                <code>use nombreDB</code>
                <span>Selecciona o crea una base de datos</span>
            </div>

            <div class="command-item">
                <code>db</code>
                <span>Muestra la base de datos actual</span>
            </div>

            <div class="command-item">
                <code>show collections</code>
                <span>Lista todas las colecciones de la BD actual</span>
            </div>

            <div class="command-item">
                <code>db.coleccion.find().pretty()</code>
                <span>Muestra documentos con formato legible</span>
            </div>

            <div class="command-item">
                <code>db.coleccion.drop()</code>
                <span>Elimina una colección completa</span>
            </div>

            <div class="command-item">
                <code>db.dropDatabase()</code>
                <span>Elimina la base de datos actual</span>
            </div>

            <div class="command-item">
                <code>db.coleccion.createIndex({ campo: 1 })</code>
                <span>Crea un índice en un campo (1 ascendente, -1 descendente)</span>
            </div>

            <div class="command-item">
                <code>db.coleccion.getIndexes()</code>
                <span>Muestra todos los índices de una colección</span>
            </div>

            <div class="command-item">
                <code>db.stats()</code>
                <span>Muestra estadísticas de la base de datos</span>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-link"></i> Recursos adicionales</h2>
            <ul>
                <li><a href="https://www.mongodb.com/docs/" target="_blank">MongoDB Official Docs</a> - Documentación oficial</li>
                <li><a href="https://mongoosejs.com/docs/" target="_blank">Mongoose Docs</a> - Documentación de Mongoose</li>
                <li><a href="https://university.mongodb.com/" target="_blank">MongoDB University</a> - Cursos gratuitos</li>
                <li><a href="https://www.mongodb.com/developer/" target="_blank">MongoDB Developer Hub</a> - Artículos y tutoriales</li>
            </ul>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Wiki Personal 2º DAW</p>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>
