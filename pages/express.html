<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Express.js - Wiki 2º DAW</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-book-open"></i>
                <h1>Wiki 2º DAW</h1>
            </div>
            <a href="../index.html" class="back-button">
                <i class="fas fa-arrow-left"></i> Volver al inicio
            </a>
        </div>
    </nav>

    <div class="detail-page">
        <div class="detail-header">
            <div class="detail-icon" style="color: var(--text-primary);">
                <i class="fas fa-server"></i>
            </div>
            <h1 class="detail-title">Express.js</h1>
            <p class="detail-subtitle">Framework web minimalista y flexible para Node.js</p>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-info-circle"></i> ¿Qué es Express.js?</h2>
            <p>
                Express.js es un framework web minimalista y flexible para Node.js que proporciona un conjunto robusto 
                de características para aplicaciones web y móviles. Facilita la creación de APIs REST, servidores web 
                y aplicaciones de una sola página de forma rápida y sencilla.
            </p>
            
            <div class="info-box">
                <h4><i class="fas fa-lightbulb"></i> Características principales</h4>
                <ul>
                    <li><strong>Routing robusto:</strong> Sistema de rutas flexible y potente</li>
                    <li><strong>Middleware:</strong> Sistema de middlewares para procesar peticiones</li>
                    <li><strong>Minimalista:</strong> Solo incluye lo esencial, añade lo que necesites</li>
                    <li><strong>Plantillas:</strong> Soporte para múltiples motores de plantillas</li>
                    <li><strong>APIs REST:</strong> Ideal para crear APIs RESTful</li>
                    <li><strong>Gran ecosistema:</strong> Miles de middlewares disponibles</li>
                </ul>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-code"></i> Instalación y configuración básica</h2>
            
            <div class="code-block">
                <pre>
// Instalar Express
npm install express

// Crear servidor básico - app.js
const express = require('express');
const app = express();
const PORT = 3000;

// Ruta básica
app.get('/', (req, res) => {
  res.send('¡Hola desde Express!');
});

// Iniciar servidor
app.listen(PORT, () => {
  console.log(`Servidor ejecutándose en http://localhost:${PORT}`);
});
                </pre>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-route"></i> Routing (Rutas)</h2>
            
            <h3>Métodos HTTP básicos</h3>
            <div class="code-block">
                <pre>
// GET - Obtener datos
app.get('/usuarios', (req, res) => {
  res.json({ mensaje: 'Lista de usuarios' });
});

// POST - Crear recurso
app.post('/usuarios', (req, res) => {
  res.json({ mensaje: 'Usuario creado' });
});

// PUT - Actualizar recurso completo
app.put('/usuarios/:id', (req, res) => {
  res.json({ mensaje: `Usuario ${req.params.id} actualizado` });
});

// PATCH - Actualizar parcialmente
app.patch('/usuarios/:id', (req, res) => {
  res.json({ mensaje: `Usuario ${req.params.id} modificado` });
});

// DELETE - Eliminar recurso
app.delete('/usuarios/:id', (req, res) => {
  res.json({ mensaje: `Usuario ${req.params.id} eliminado` });
});
                </pre>
            </div>

            <h3>Parámetros de ruta</h3>
            <div class="code-block">
                <pre>
// Parámetros de URL
app.get('/usuarios/:id', (req, res) => {
  const id = req.params.id;
  res.json({ mensaje: `Usuario con ID: ${id}` });
});

// Múltiples parámetros
app.get('/usuarios/:id/posts/:postId', (req, res) => {
  const { id, postId } = req.params;
  res.json({ usuarioId: id, postId: postId });
});

// Query parameters (?nombre=Juan&edad=25)
app.get('/buscar', (req, res) => {
  const { nombre, edad } = req.query;
  res.json({ nombre, edad });
});
                </pre>
            </div>

            <h3>Router modular</h3>
            <div class="code-block">
                <pre>
// routes/usuarios.js
const express = require('express');
const router = express.Router();

router.get('/', (req, res) => {
  res.json({ mensaje: 'Lista de usuarios' });
});

router.post('/', (req, res) => {
  res.json({ mensaje: 'Usuario creado' });
});

router.get('/:id', (req, res) => {
  res.json({ mensaje: `Usuario ${req.params.id}` });
});

module.exports = router;

// app.js
const usuariosRouter = require('./routes/usuarios');
app.use('/api/usuarios', usuariosRouter);
                </pre>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-layer-group"></i> Middleware</h2>
            
            <h3>Middleware incorporado</h3>
            <div class="code-block">
                <pre>
// Parse JSON en el body
app.use(express.json());

// Parse URL-encoded data
app.use(express.urlencoded({ extended: true }));

// Servir archivos estáticos
app.use(express.static('public'));
                </pre>
            </div>

            <h3>Middleware personalizado</h3>
            <div class="code-block">
                <pre>
// Logger personalizado
const logger = (req, res, next) => {
  console.log(`${req.method} ${req.url} - ${new Date().toISOString()}`);
  next();  // Importante: llamar a next() para continuar
};

app.use(logger);

// Middleware de autenticación
const autenticar = (req, res, next) => {
  const token = req.headers.authorization;
  
  if (!token) {
    return res.status(401).json({ error: 'No autorizado' });
  }
  
  // Verificar token...
  next();
};

// Usar en rutas específicas
app.get('/admin', autenticar, (req, res) => {
  res.json({ mensaje: 'Área de administración' });
});
                </pre>
            </div>

            <h3>Middleware de terceros</h3>
            <div class="code-block">
                <pre>
// CORS - Permitir peticiones cross-origin
const cors = require('cors');
app.use(cors());

// Morgan - Logger de peticiones HTTP
const morgan = require('morgan');
app.use(morgan('dev'));

// Helmet - Seguridad HTTP headers
const helmet = require('helmet');
app.use(helmet());

// Cookie Parser
const cookieParser = require('cookie-parser');
app.use(cookieParser());

// Compression - Comprimir respuestas
const compression = require('compression');
app.use(compression());
                </pre>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-database"></i> API REST completa con MongoDB</h2>
            
            <h3>Estructura del proyecto</h3>
            <div class="code-block">
                <pre>
proyecto/
├── src/
│   ├── controllers/
│   │   └── usuarioController.js
│   ├── models/
│   │   └── Usuario.js
│   ├── routes/
│   │   └── usuarios.js
│   ├── middleware/
│   │   └── auth.js
│   ├── config/
│   │   └── db.js
│   └── app.js
├── .env
├── package.json
└── server.js
                </pre>
            </div>

            <h3>Configuración de la base de datos</h3>
            <div class="code-block">
                <pre>
// config/db.js
const mongoose = require('mongoose');

const connectDB = async () => {
  try {
    await mongoose.connect(process.env.MONGO_URI, {
      useNewUrlParser: true,
      useUnifiedTopology: true
    });
    console.log('MongoDB conectado correctamente');
  } catch (err) {
    console.error('Error de conexión a MongoDB:', err);
    process.exit(1);
  }
};

module.exports = connectDB;
                </pre>
            </div>

            <h3>Modelo</h3>
            <div class="code-block">
                <pre>
// models/Usuario.js
const mongoose = require('mongoose');

const usuarioSchema = new mongoose.Schema({
  nombre: {
    type: String,
    required: true,
    trim: true
  },
  email: {
    type: String,
    required: true,
    unique: true,
    lowercase: true
  },
  password: {
    type: String,
    required: true,
    minlength: 6
  },
  edad: Number,
  activo: {
    type: Boolean,
    default: true
  }
}, {
  timestamps: true
});

module.exports = mongoose.model('Usuario', usuarioSchema);
                </pre>
            </div>

            <h3>Controlador</h3>
            <div class="code-block">
                <pre>
// controllers/usuarioController.js
const Usuario = require('../models/Usuario');

// Obtener todos los usuarios
exports.obtenerTodos = async (req, res) => {
  try {
    const usuarios = await Usuario.find();
    res.json(usuarios);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
};

// Obtener usuario por ID
exports.obtenerPorId = async (req, res) => {
  try {
    const usuario = await Usuario.findById(req.params.id);
    
    if (!usuario) {
      return res.status(404).json({ error: 'Usuario no encontrado' });
    }
    
    res.json(usuario);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
};

// Crear usuario
exports.crear = async (req, res) => {
  try {
    const nuevoUsuario = new Usuario(req.body);
    const guardado = await nuevoUsuario.save();
    res.status(201).json(guardado);
  } catch (err) {
    res.status(400).json({ error: err.message });
  }
};

// Actualizar usuario
exports.actualizar = async (req, res) => {
  try {
    const actualizado = await Usuario.findByIdAndUpdate(
      req.params.id,
      req.body,
      { new: true, runValidators: true }
    );
    
    if (!actualizado) {
      return res.status(404).json({ error: 'Usuario no encontrado' });
    }
    
    res.json(actualizado);
  } catch (err) {
    res.status(400).json({ error: err.message });
  }
};

// Eliminar usuario
exports.eliminar = async (req, res) => {
  try {
    const eliminado = await Usuario.findByIdAndDelete(req.params.id);
    
    if (!eliminado) {
      return res.status(404).json({ error: 'Usuario no encontrado' });
    }
    
    res.json({ mensaje: 'Usuario eliminado correctamente' });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
};
                </pre>
            </div>

            <h3>Rutas</h3>
            <div class="code-block">
                <pre>
// routes/usuarios.js
const express = require('express');
const router = express.Router();
const usuarioController = require('../controllers/usuarioController');

router.get('/', usuarioController.obtenerTodos);
router.get('/:id', usuarioController.obtenerPorId);
router.post('/', usuarioController.crear);
router.put('/:id', usuarioController.actualizar);
router.delete('/:id', usuarioController.eliminar);

module.exports = router;
                </pre>
            </div>

            <h3>App principal</h3>
            <div class="code-block">
                <pre>
// app.js
require('dotenv').config();
const express = require('express');
const cors = require('cors');
const morgan = require('morgan');
const connectDB = require('./config/db');

const app = express();

// Conectar a MongoDB
connectDB();

// Middlewares
app.use(cors());
app.use(morgan('dev'));
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Rutas
app.use('/api/usuarios', require('./routes/usuarios'));

// Ruta de prueba
app.get('/', (req, res) => {
  res.json({ mensaje: 'API funcionando correctamente' });
});

// Manejo de errores 404
app.use((req, res) => {
  res.status(404).json({ error: 'Ruta no encontrada' });
});

// Manejo de errores global
app.use((err, req, res, next) => {
  console.error(err.stack);
  res.status(500).json({ error: 'Error del servidor' });
});

module.exports = app;
                </pre>
            </div>

            <h3>Servidor</h3>
            <div class="code-block">
                <pre>
// server.js
const app = require('./src/app');
const PORT = process.env.PORT || 3000;

app.listen(PORT, () => {
  console.log(`Servidor ejecutándose en puerto ${PORT}`);
});
                </pre>
            </div>

            <h3>Variables de entorno (.env)</h3>
            <div class="code-block">
                <pre>
PORT=3000
MONGO_URI=mongodb://localhost:27017/miapp
NODE_ENV=development
JWT_SECRET=mi_secreto_super_seguro
                </pre>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-shield-alt"></i> Validación y manejo de errores</h2>
            
            <div class="code-block">
                <pre>
// Validación con express-validator
const { body, validationResult } = require('express-validator');

// Middleware de validación
const validarUsuario = [
  body('nombre').notEmpty().withMessage('El nombre es requerido'),
  body('email').isEmail().withMessage('Email inválido'),
  body('password').isLength({ min: 6 }).withMessage('Password mínimo 6 caracteres'),
  body('edad').optional().isInt({ min: 0 }).withMessage('Edad debe ser un número positivo')
];

// Usar en la ruta
router.post('/', validarUsuario, (req, res) => {
  const errors = validationResult(req);
  
  if (!errors.isEmpty()) {
    return res.status(400).json({ errors: errors.array() });
  }
  
  // Continuar con la creación...
});
                </pre>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-terminal"></i> Comandos y scripts útiles</h2>
            
            <div class="command-item">
                <code>npm install express</code>
                <span>Instala Express.js en el proyecto</span>
            </div>

            <div class="command-item">
                <code>npm install nodemon -D</code>
                <span>Instala Nodemon para desarrollo (auto-restart)</span>
            </div>

            <div class="command-item">
                <code>npx express-generator</code>
                <span>Genera estructura básica de proyecto Express</span>
            </div>

            <div class="command-item">
                <code>npm start</code>
                <span>Ejecuta el servidor (script en package.json)</span>
            </div>

            <div class="command-item">
                <code>npm run dev</code>
                <span>Ejecuta con Nodemon para desarrollo</span>
            </div>

            <h3>package.json - Scripts recomendados</h3>
            <div class="code-block">
                <pre>
{
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "test": "jest"
  }
}
                </pre>
            </div>
        </div>

        <div class="content-section">
            <h2><i class="fas fa-link"></i> Recursos adicionales</h2>
            <ul>
                <li><a href="https://expressjs.com/" target="_blank">Express.js Official</a> - Documentación oficial</li>
                <li><a href="https://github.com/expressjs/express" target="_blank">Express GitHub</a> - Repositorio oficial</li>
                <li><a href="https://github.com/raywenderlich/node-express-course" target="_blank">Express Course</a> - Curso completo</li>
            </ul>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Wiki Personal 2º DAW</p>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>
